<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pinch Gesture Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .instruction {
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            padding: 0 1rem;
        }

        .gesture-type {
            color: #00d4ff;
            font-weight: bold;
        }

        .signal {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 2rem;
            transition: all 0.2s ease;
        }

        .signal.detected {
            background: #00ff88;
            color: #000;
            transform: scale(1.2);
        }

        .signal.wrong {
            background: #ff4444;
            color: white;
        }

        .detected-gesture {
            font-size: 1.5rem;
            margin-top: 1rem;
            min-height: 2rem;
        }

        .stats {
            position: fixed;
            bottom: 2rem;
            font-size: 0.9rem;
            color: #888;
        }

        .context-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            background: #ff6b00;
            color: white;
            border-radius: 4px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.1s;
        }

        .context-indicator.show {
            opacity: 1;
        }

        .next-btn {
            margin-top: 2rem;
            padding: 1rem 2rem;
            font-size: 1rem;
            background: #00d4ff;
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="instruction">
        Press <span class="gesture-type" id="target"></span>
    </div>

    <div class="signal" id="signal">
        Waiting...
    </div>

    <div class="detected-gesture" id="detected"></div>

    <button class="next-btn" id="nextBtn">Next</button>

    <div class="stats" id="stats">Score: 0 / 0</div>
    <div class="context-indicator" id="contextIndicator">ContextMenu</div>

    <script>
        const gestures = ['pinch', 'double-pinch', 'long-pinch'];
        let targetGesture = '';
        let correct = 0;
        let total = 0;

        // Gesture detection state
        let touchStartTime = 0;
        let lastPinchTime = 0;
        let isPinching = false;
        let pinchCount = 0;
        let pinchTimer = null;
        let longPinchTimer = null;

        const LONG_PINCH_THRESHOLD = 500; // ms
        const DOUBLE_PINCH_THRESHOLD = 400; // ms between clicks

        const targetEl = document.getElementById('target');
        const signalEl = document.getElementById('signal');
        const detectedEl = document.getElementById('detected');
        const statsEl = document.getElementById('stats');
        const nextBtn = document.getElementById('nextBtn');

        function randomGesture() {
            targetGesture = gestures[Math.floor(Math.random() * gestures.length)];
            targetEl.textContent = targetGesture;
            signalEl.textContent = 'Waiting...';
            signalEl.className = 'signal';
            detectedEl.textContent = '';
            pinchCount = 0;
        }

        function showResult(detectedGesture) {
            detectedEl.textContent = `Detected: ${detectedGesture}`;
            total++;

            if (detectedGesture === targetGesture) {
                correct++;
                signalEl.textContent = 'Correct!';
                signalEl.className = 'signal detected';
                // Auto advance after correct
                setTimeout(randomGesture, 800);
            } else {
                signalEl.textContent = 'Wrong!';
                signalEl.className = 'signal wrong';
            }

            statsEl.textContent = `Score: ${correct} / ${total}`;
        }

        // Right-click (contextmenu) detection
        const contextIndicator = document.getElementById('contextIndicator');
        document.body.addEventListener('mousedown', (e) => {
            if (e.button === 2) { // Right-click
                e.preventDefault();
                isPinching = true;
                touchStartTime = Date.now();
                contextIndicator.classList.add('show');

                // Start long pinch detection
                longPinchTimer = setTimeout(() => {
                    if (isPinching) {
                        clearTimeout(pinchTimer);
                        pinchCount = 0;
                        showResult('long-pinch');
                        isPinching = false;
                    }
                }, LONG_PINCH_THRESHOLD);
            }
        });

        document.body.addEventListener('mouseup', (e) => {
            if (e.button === 2) { // Right-click release
                contextIndicator.classList.remove('show');
                if (!isPinching) return;
                e.preventDefault();
                const duration = Date.now() - touchStartTime;
                isPinching = false;

                clearTimeout(longPinchTimer);

                // If it was a long pinch, already handled
                if (duration >= LONG_PINCH_THRESHOLD) return;

                // Short pinch - check for double
                pinchCount++;

                if (pinchTimer) clearTimeout(pinchTimer);

                pinchTimer = setTimeout(() => {
                    if (pinchCount >= 2) {
                        showResult('double-pinch');
                    } else {
                        showResult('pinch');
                    }
                    pinchCount = 0;
                }, DOUBLE_PINCH_THRESHOLD);
            }
        });

        // Prevent context menu
        document.body.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        nextBtn.addEventListener('click', randomGesture);

        // Initialize
        randomGesture();
    </script>
</body>
</html>
